# üí° 2-Light_Gest_Col_Prox ‚Äì Capteur TMG39931 (Heltec WiFi LoRa 32 V3)

Ce projet Arduino permet de lire et afficher en temps r√©el les **valeurs de proximit√©**, **couleurs RVB**, et des donn√©es **chromatiques** depuis le capteur **TMG39931**, en communication directe via le bus I2C.

Aucun pilote externe n‚Äôest utilis√© : **seule la biblioth√®que `Wire.h`** est n√©cessaire, pour une gestion fine des registres.

---

## üì∑ Capture d‚Äô√©cran du Moniteur S√©rie

![Capture s√©rie](./TMG39931.png)

---

## üîß Mat√©riel utilis√©

- **Carte** : Heltec WiFi LoRa 32 (V3)
- **Capteur** : AMS TMG39931
- **Communication** : I2C

| Signal I2C | Pin Heltec utilis√©e | GPIO |
|------------|---------------------|------|
| SDA        | J3 Pin 8            | 41   |
| SCL        | J3 Pin 7            | 42   |

---

## üß∞ Biblioth√®que utilis√©e

| Biblioth√®que | R√¥le                                                                 |
|--------------|----------------------------------------------------------------------|
| `Wire.h`     | G√®re la communication I2C entre la carte Heltec et le capteur TMG39931 |

---

## üß† Ce que fait le code

- Initialise le capteur TMG39931 via des **√©critures manuelles dans les registres I2C**
- Lit toutes les 10 secondes :
  - **Proximit√©**
  - **Rouge, Vert, Bleu, Clear**
  - **Flux lumineux approximatif**
  - **Coordonn√©es chromatiques normalis√©es**
  - **Coordonn√©es CIE x/y**
- Possibilit√© de **mettre en pause les mesures** (`p`), de faire une **mesure unique** (`n`) ou de **red√©marrer** (`r`)

---

## üß© Description des registres manipul√©s

Le code communique directement avec les registres internes du capteur via I2C.

| Registre         | Adresse | Utilit√©                                 |
|------------------|---------|------------------------------------------|
| `ID`             | 0x92    | V√©rifie l'identit√© du capteur (doit valoir 0xAB) |
| `ENABLE`         | 0x80    | Active/d√©sactive le capteur              |
| `ATIME`          | 0x81    | Temps d‚Äôint√©gration du capteur couleur   |
| `PERS`           | 0x8C    | Persistance d‚Äôinterruption               |
| `CONTROL`        | 0x8F    | Contr√¥le du gain                         |
| `PDATA`          | 0x9C    | Donn√©e brute de proximit√©                |
| `CDATAL/H`, etc. | 0x94+   | Donn√©es de couleur 16 bits (Clear, R, G, B) |

---

## üîç Fonctions principales du code

| Fonction                  | R√¥le |
|---------------------------|------|
| `writeRegister()`         | √âcrit une valeur dans un registre du capteur via I2C |
| `readRegister()`          | Lit une valeur d‚Äôun registre via I2C |
| `initializeTMG39931()`    | Configure le capteur pour l‚Äôacquisition (activation, gain, timing) |
| `readSensorData()`        | R√©cup√®re les donn√©es de capteurs, les affiche et effectue des calculs chromatiques |
| `loop()` / `setup()`      | G√®rent le d√©marrage, la pause, les commandes clavier et la prise p√©riodique de mesure |

---

## üé® Traitement des donn√©es couleurs

- **Flux lumineux** : calcul√© via une pond√©ration RVB type luminance vid√©o :  
  `0.299 * R + 0.587 * G + 0.114 * B`

- **Coordonn√©es chromatiques (r, g, b)** :  
  Normalisation des valeurs RGB pour obtenir leur proportion.

- **Conversion CIE (x, y)** :  
  Utilise une approximation XYZ simplifi√©e pour repr√©senter la position chromatique sur le plan CIE 1931.

---

## ‚å®Ô∏è Commandes disponibles (via Serial Monitor)

- `p` ‚Äì Pause ou reprise automatique des mesures
- `n` ‚Äì Mesure manuelle (en pause uniquement)
- `r` ‚Äì Red√©marre le syst√®me

---

## üìÅ Fichiers

- [`TMG39931.ino`](./TMP39931.ino) ‚Äì Le code complet du projet
- [`TMG39931.png`](./TMP39931.png) ‚Äì Capture du moniteur s√©rie

---
